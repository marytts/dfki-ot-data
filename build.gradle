buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath group: 'org.yaml', name: 'snakeyaml', version: '1.17'
    }
}

group 'de.dfki.mary'
version '0.1-SNAPSHOT'

import org.yaml.snakeyaml.*

task soxi << {
    def options = new DumperOptions()
    options.defaultFlowStyle = DumperOptions.FlowStyle.BLOCK
    def yaml = new Yaml(options)
    def data = [:]
    fileTree('wav_44K').include('*.wav').each { wavFile ->
        def soxi = "soxi $wavFile".execute()
        soxi.waitFor()
        def basename = wavFile.name - '.wav'
        def info = yaml.load(soxi.text)
        data[basename] = info
    }
    file('soxi.yaml').text = yaml.dump(data)
}

task offsets(type: Exec) {
    def scriptFile = file("$rootDir/offsets.praat")
    commandLine 'praat', '--run', scriptFile
    doFirst {
        def dir1 = 'wav_44K'
        def dir2 = 'wav'
        def fileSet = fileTree(dir1).include('*.wav').collect {
            it.name
        }.intersect(fileTree(dir2).include('*.wav').collect { it.name })
        def list1File = file("$temporaryDir/wav1.lst")
        list1File.text = fileSet.collect { file("$dir1/$it") }.join('\n')
        def list2File = file("$temporaryDir/wav2.lst")
        list2File.text = fileSet.collect { file("$dir2/$it") }.join('\n')
        commandLine += [list1File, list2File]
    }
}
